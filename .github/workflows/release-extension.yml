name: ğŸ“¦ Release AE Extension

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'ç‰ˆæœ¬å· (ä¾‹å¦‚: v1.0.0)'
        required: true
        default: 'v1.0.0'
        type: string
      release_name:
        description: 'å‘å¸ƒåç§°'
        required: false
        default: ''
        type: string
      release_notes:
        description: 'å‘å¸ƒè¯´æ˜'
        required: false
        default: ''
        type: string
      prerelease:
        description: 'æ˜¯å¦ä¸ºé¢„å‘å¸ƒç‰ˆæœ¬'
        required: false
        default: false
        type: boolean

jobs:
  release:
    name: ğŸš€ æ‰“åŒ…å¹¶å‘å¸ƒæ‰©å±•
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        
      - name: ğŸ“‹ éªŒè¯demoæ–‡ä»¶å¤¹
        run: |
          if [ ! -d "public/demo" ]; then
            echo "âŒ public/demo æ–‡ä»¶å¤¹ä¸å­˜åœ¨"
            exit 1
          fi
          echo "âœ… public/demo æ–‡ä»¶å¤¹å­˜åœ¨"
          echo "ğŸ“ æ–‡ä»¶å¤¹å†…å®¹ï¼š"
          ls -la public/demo/
          
      - name: ğŸ“¦ åˆ›å»ºæ‰©å±•å‹ç¼©åŒ…
        run: |
          cd public
          # åˆ›å»ºä¸´æ—¶ç›®å½•
          mkdir -p temp/Uiineed-Todo-List-For-AE
          
          # å¤åˆ¶demoæ–‡ä»¶å¤¹å†…å®¹åˆ°ä¸´æ—¶ç›®å½•
          cp -r demo/* temp/Uiineed-Todo-List-For-AE/
          
          # åˆ›å»ºå‹ç¼©åŒ…
          cd temp
          zip -r "../Uiineed-Todo-List-For-AE-${{ github.event.inputs.version }}.zip" Uiineed-Todo-List-For-AE/
          
          # éªŒè¯å‹ç¼©åŒ…
          echo "âœ… å‹ç¼©åŒ…åˆ›å»ºå®Œæˆï¼š"
          ls -la ../Uiineed-Todo-List-For-AE-${{ github.event.inputs.version }}.zip
          
          # æ¸…ç†ä¸´æ—¶ç›®å½•
          cd ..
          rm -rf temp
          
      - name: ğŸ“ ç”Ÿæˆå‘å¸ƒè¯´æ˜
        id: release_notes
        run: |
          if [ -n "${{ github.event.inputs.release_notes }}" ]; then
            NOTES="${{ github.event.inputs.release_notes }}"
          else
            NOTES="## ğŸ‰ UINeed Todo AE æ‰©å±• ${{ github.event.inputs.version }}

          ### ğŸ“¦ å®‰è£…è¯´æ˜
          1. ä¸‹è½½ \`Uiineed-Todo-List-For-AE-${{ github.event.inputs.version }}.zip\`
          2. è§£å‹åˆ°AEæ‰©å±•ç›®å½•ï¼š
             - **Windows**: \`C:\\Program Files (x86)\\Common Files\\Adobe\\CEP\\extensions\`
             - **macOS**: \`/Library/Application Support/Adobe/CEP/extensions\`
          3. é¦–æ¬¡å®‰è£…éœ€è¦å¼€å¯CEPæ‰©å±•è°ƒè¯•æ¨¡å¼ï¼š
             - **Windows**: ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ \`REG ADD HKEY_CURRENT_USER\\Software\\Adobe\\CSXS.11 /v PlayerDebugMode /t REG_STRING /d 1\`
             - **macOS**: ç»ˆç«¯è¿è¡Œ \`defaults write com.adobe.CSXS.11 PlayerDebugMode 1\`
          4. é‡å¯AEåï¼Œåœ¨"çª—å£ > æ‰©å±•"èœå•ä¸­æ‰“å¼€

          ### ğŸš€ åŠŸèƒ½ç‰¹æ€§
          - âœ¨ æµç•…çš„UIäº¤äº’åŠ¨æ•ˆ
          - ğŸ“ åˆ›å»ºã€ç¼–è¾‘ã€å®Œæˆã€åˆ é™¤å¾…åŠäº‹é¡¹
          - ğŸ”— å¯æ‹–æ‹½è¿›è¡Œä»»åŠ¡æ’åº
          - ğŸ”„ ä¸AEé¡¹ç›®é›†æˆï¼Œå¯ç›´æ¥åœ¨AEä¸­ä½¿ç”¨
          - ğŸ’¾ æœ¬åœ°å­˜å‚¨ä¿å­˜ã€å¯¼å‡ºå¯¼å…¥æ•°æ®

          ### ğŸ“– ç›¸å…³é“¾æ¥
          - ğŸ“š [åœ¨çº¿æ–‡æ¡£](https://docs.xn--jcs561df75a.space/)
          - ğŸš€ [åœ¨çº¿æ¼”ç¤º](https://todo.xn--jcs561df75a.space/)
          - ğŸ’» [é¡¹ç›®æºç ](https://github.com/yancongya/Uiineed-Todo-List-For-AE-Docs)

          ---
          > ğŸ’¡ å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ [Issues](https://github.com/yancongya/Uiineed-Todo-List-For-AE-Docs/issues) ä¸­åé¦ˆ"
          fi
          
          # å°†å‘å¸ƒè¯´æ˜ä¿å­˜åˆ°æ–‡ä»¶ï¼Œå¤„ç†å¤šè¡Œæ–‡æœ¬
          echo "$NOTES" > release_notes.md
          echo "notes_file=release_notes.md" >> $GITHUB_OUTPUT
          
      - name: ğŸ·ï¸ åˆ›å»ºReleaseå¹¶ä¸Šä¼ æ–‡ä»¶
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.event.inputs.version }}
          name: ${{ github.event.inputs.release_name || format('UINeed Todo AE {0}', github.event.inputs.version) }}
          body_path: ${{ steps.release_notes.outputs.notes_file }}
          draft: false
          prerelease: ${{ github.event.inputs.prerelease }}
          files: ./public/Uiineed-Todo-List-For-AE-${{ github.event.inputs.version }}.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: âœ… å‘å¸ƒå®Œæˆ
        run: |
          echo "ğŸ‰ Release åˆ›å»ºæˆåŠŸï¼"
          echo "ğŸ“¦ å‹ç¼©åŒ…: Uiineed-Todo-List-For-AE-${{ github.event.inputs.version }}.zip"
          echo "ğŸ”— Release URL: https://github.com/${{ github.repository }}/releases/tag/${{ github.event.inputs.version }}"
          echo ""
          echo "ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œï¼š"
          echo "1. æ£€æŸ¥Releaseé¡µé¢ç¡®è®¤ä¿¡æ¯æ­£ç¡®"
          echo "2. æµ‹è¯•ä¸‹è½½çš„å‹ç¼©åŒ…æ˜¯å¦æ­£å¸¸"
          echo "3. åœ¨AEä¸­æµ‹è¯•æ‰©å±•åŠŸèƒ½"
